---

prefixes:
    - "database_db_"
    - "mysql_"

classes:
    - database

dependencies:
  - database
  - mysqlconfig
  - postgresconfig
  - mysql
  - postgresql
  - stdlib
  - concat
  - apt

database::type: 'mysql'

mysqlconfig::custom_mysql_options:
  mysqld:
    'max_allowed_packet': "%{::mysql_max_allowed_packet}"
    'character-set-server': 'utf8'
    'collation_server': 'utf8_bin'
    'default-storage-engine': 'innodb'
    'transaction-isolation': 'READ-COMMITTED'
    'bind_address': "%{::mysql_bind_address}"
    'innodb_log_file_size': "%{::mysql_innodb_log_file_size}"
mysqlconfig::max_allowed_packet: "%{::mysql_max_allowed_packet}"
mysqlconfig::init_script_timeout: "%{::mysql_init_script_timeout}"

mysql::server::root_password: "%{::mysql_root_password}"

database::conf:
  "%{::database_db_database_name}":
    host:     'localhost'
    collate:  'utf8_bin'
    charset:  'utf8'
    user:     "%{::database_db_database_user}"
    password: "%{::database_db_database_pass}"
    name:     "%{::database_db_database_name}"